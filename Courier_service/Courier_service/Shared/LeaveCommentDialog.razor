@using Courier_service.Models

@inject ISnackbar Snackbar

<MudDialog>
	<TitleContent>
		<MudText Typo="Typo.h4">
			Comment
		</MudText>
	</TitleContent>
	<DialogContent>
		<MudTextField Lines="10" Placeholder="Your comment" Required="true" @bind-Value="@comment" />
	</DialogContent>
	<DialogActions>
		<MudButton OnClick="Cancel">Cancel</MudButton>
		<MudButton Color="Color.Primary" OnClick="Submit">Ok</MudButton>
	</DialogActions>
</MudDialog>

@code {
	[CascadingParameter] MudDialogInstance MudDialog { get; set; }

	[Parameter] public int orderId { get; set; }
	[Parameter] public DatabaseService databaseService { get; set; }

	string comment { get; set; } = "";

	void Submit()
	{
		if (comment != "")
		{
			try
			{
				databaseService.AddComment(comment, orderId);
				Snackbar.Add("Comment added!", Severity.Success);
				MudDialog.Close(DialogResult.Ok(true));
			}
			catch
			{
				Snackbar.Add("Something went wrong while leaving comment!", Severity.Error);
				Cancel();
			}
		}
		else Snackbar.Add("Comment is empty!", Severity.Warning);
	}

	void Cancel() => MudDialog.Cancel();
}